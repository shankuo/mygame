function IAnim(a,b,c){function m(a,b,c){d=!1,l.isLoop=!1,l.sanim=new ISprite(a[0],c),l.sanim.z=b,g=-1,e=a}var d,e,f,g,h,i,j,k,l;this.isLoop=!1,this.sanim=null,d=!1,e=new Array,f=1,g=0,h=1,i=null,j={},k=0,l=this,Object.defineProperty(this,"x",{get:function(){return l.sanim.x},set:function(a){l.sanim.x=a}}),Object.defineProperty(this,"y",{get:function(){return l.sanim.y},set:function(a){l.sanim.y=a}}),Object.defineProperty(this,"z",{get:function(){return l.z},set:function(a){l.sanim.z=a}}),void 0==c?m(a,b,null):m(a,b,c),Object.defineProperty(this,"onload",{set:function(a){l.sanim.onload=function(){a(l)}}}),this.setPlaytimes=function(a){this.times=a},this.setIndex=function(a){this.sanim.setBitmap(e[a])},this.setXY=function(a,b){this.sanim.x=a,this.sanim.y=b},this.setSpeed=function(a){f=a,h=a},this.start=function(){d=!0,this.sanim.visible=!0,this.sanim.setBitmap(e[0]),g>=e.length&&(g=-1)},this.stop=function(){d=!1,this.sanim.visible=!1,g=-1},this.setBitmaps=function(a,b){this.stop(),b&&(e=[]),e=a},this.update=function(){if(d&&h>0&&(h-=1,0==h))if(h=f,g+=1,g<e.length)null!=j[g]&&j[g](l),this.sanim.setBitmap(e[g]);else if(this.isLoop)g=0,this.sanim.setBitmap(e[g]);else{if(k>0)return k-=1,g=0,void 0;d=!1,g=-1,this.sanim.visible=!1,null!=i&&i(l)}},this.pause=function(){d=!1},this.isFinishd=function(){return!d},this.dispose=function(){this.sanim.disposeMin(),e=[]},this.disposeMin=function(){this.sanim.disposeMin()},this.setOnFinishAnim=function(a){i=a},this.setOnFrameAnim=function(a,b){j[b]=a},this.removeFrameAnim=function(a){delete j[a]},this.clearFrameAnim=function(){j={}}}function IAudio(){}function updateBGMFade(){if(!(0>=bgmFTM)){if(0>=bgmFTN)return bgmFTM=0,void 0;bgmFTN-=1;var a=bgmYV*(bgmFTN/bgmFTM);bgm.volume=a/100}}function updateBGSFade(){if(!(0>=bgsFTM)){if(0>=bgsFTN)return bgsFTN=0,void 0;bgsFTN-=1;var a=bgsYV*(bgsFTN/bgsFTM);bgs.volume=a/100}}function isWeiXin(){var a=window.navigator.userAgent.toLowerCase();return console.log(a),"micromessenger"==a.match(/MicroMessenger/i)}function IBitmap(){}function callImage(a){return a.complete?a:null!=a.error?null:a}function CBmp(a,b){this.width=a,this.height=b}function IBCof(a,b,c,d,e){this.bitmap=a,this.x=b,this.y=c,this.width=d,this.height=e,this.dispose=function(){this.bitmap=null}}function IBox(){function d(a,b){return a-b}function e(a){var c,b=[];for(c in a)b.push(c);return b}var b={},c=[];this.getSize=function(){var c,d,e,a=0;for(c in b)for(d=b[c],e=0;e<d.length;e++)a+=d[e]instanceof ISprite||d[e]instanceof IDraw?1:d[e].zbox.getSize();return a},this.add=function(a){null==b[a.z]&&(b[a.z]=[],c=e(b).sort(d)),b[a.z].push(a)},this.setZ=function(a,f){if(!a.isNoZ(f)){var g=b[a.getOldZ()];g.remove(a),g.length<=0&&(delete b[a.getOldZ()],c=e(b).sort(d)),null==b[f]&&(b[f]=[],c=e(b).sort(d)),a.setZ(f),b[f].push(a),a.updateZ()}},this.remove=function(a){b[a.getOldZ()].remove(a)},this.getAll=function(){return b},this.update=function(){var a,d,e;if(null!=c)for(a=c.length-1;a>=0;a--)for(d=b[c[a]],e=d.length-1;e>=0;e--)d[e].update()}}function IButton(a,b,c,d,e){var o,w,x,z,f=[],g=null,h=null,i=null,j=null,k="",l=!1,m=!1;this.tag=null,o=!1,this.click=IVal.dSound,w=-1,x=1,this.drawTitle=function(a,b,c){var d,e;void 0==b&&(b=-1),void 0==c&&(c=-1),i.clearBitmap(),d=IFont.getWidth(a,IVal.FontSize),e=IFont.getHeight(a,IVal.FontSize),-1==b&&-1==c?i.drawText(a,(i.width-d)/2,(i.height-e)/2):i.drawText(a,b,c),i.updateBitmap()},this.drawTitleQ=function(a,b,c){var d,e;i.clearBitmap(),d=IFont.getWidth(a,c),e=IFont.getHeight(a,c),i.drawTextQ(a,(i.width-d)/2,(i.height-e)/2,b,c),i.updateBitmap()},z=this,void 0==c&&(c=""),k=c,void 0==d&&(d=null),void 0==e&&(e=!1),f[0]=a,f[1]=b,Object.defineProperty(this,"onload",{set:function(a){h.onload=function(){e&&(j.width=h.width,j.height=h.height),k.length>0&&(i.width=h.width,i.height=h.height,i.clearBitmap(),z.drawTitleQ(k,IVal.FontColor,IVal.FontSize)),a(z)}}}),h=new ISprite(f[0],d),e&&(j=new ISprite(IBitmap.CBitmap(h.width,h.height),d)),k.length>0&&(i=new ISprite(IBitmap.CBitmap(h.width,h.height),d),z.drawTitleQ(k,IVal.FontColor,IVal.FontSize)),l=!0,this.z=0,this.toSimple=function(a,b){w=a,x=b,a>=0&&(h.yx=.5,h.yy=.5,null!=j?(j.yx=.5,j.yy=.5):null!=i&&(i.yx=.5,i.yy=.5))},this.setYXYY=function(a,b){h.yx=a,h.yy=b,null!=j?(j.yx=a,j.yy=b):null!=i&&(i.yx=a,i.yy=b)},this.setBitmap=function(a,b,c){c&&(f[0]=null,f[1]=null),f[0]=a,f[1]=b,h.setBitmap(f[0]),o=!1},this.getSprite=function(){return j},this.getText=function(){return i},this.exchange=function(){var a=f[0];f[0]=f[1],f[1]=a},this.dispose=function(){null!=i&&i.dispose(),null!=j&&j.dispose(),null!=f[0]&&(f[0]=null),null!=f[1]&&(f[1]=null),null!=g&&(g=null),f=[],h.dispose()},this.disposeMin=function(){null!=i&&i.disposeMin(),null!=j&&j.disposeMin(),h.disposeMin()},this.isSelected=function(){return h.isSelected()},this.setEnableBitmap=function(a){g=a},this.setEnable=function(a){null!=g&&(l=a,a?h.setBitmap(f[0]):h.setBitmap(g),o=!1)},this.getEnable=function(){return l},this.isClick=function(){if(!h.visible)return!1;if(!l)return!1;var a=2==h.isSelectTouch();return a&&null!=this.click&&this.click.play(),a},this.isDown=function(){return h.isSelected()&&IInput.up},this.isOn=function(){return m},this.cancelSelect=function(){if(m){m=!1;var a=f[m?1:0];a!=h.getBitmap()&&h.setBitmap(a)}},this.getBack=function(){return h},this.getX=function(){return h.x},this.getY=function(){return h.y},this.getZ=function(){return h.z},this.setX=function(a){h.x=a,null!=i&&(i.x=a),null!=j&&(j.x=a)},this.setY=function(a){h.y=a,null!=i&&(i.y=a),null!=j&&(j.y=a)},this.setZ=function(a){h.z=a,null!=i&&(i.z=a+2),null!=j&&(j.z=a+1)},this.setZoomX=function(a){h.zoomX=a,null!=i&&(i.zoomX=a),null!=j&&(j.zoomX=a)},this.setZoomY=function(a){h.zoomY=a,null!=i&&(i.zoomY=a),null!=j&&(j.zoomY=a)},this.setVisible=function(a){h.visible=a,null!=i&&(i.visible=a),null!=j&&(j.visible=a)},this.width=function(){return h.width},this.height=function(){return h.height},this.setOpactiy=function(a){h.opacity=a,null!=i&&(i.opacity=a),null!=j&&(j.opacity=a)},Object.defineProperty(this,"x",{get:function(){return h.x},set:function(a){h.x=a,null!=i&&(i.x=a),null!=j&&(j.x=a)}}),Object.defineProperty(this,"y",{get:function(){return h.y},set:function(a){h.y=a,null!=i&&(i.y=a),null!=j&&(j.y=a)}}),Object.defineProperty(this,"z",{get:function(){return h.z},set:function(a){h.z=a,null!=i&&(i.z=a+1),null!=j&&(j.z=a+2)}}),Object.defineProperty(this,"zoomX",{get:function(){return h.zoomX},set:function(a){h.zoomX=a,null!=i&&(i.zoomX=a),null!=j&&(j.zoomX=a)}}),Object.defineProperty(this,"zoomY",{get:function(){return h.zoomY},set:function(a){h.zoomY=a,null!=i&&(i.zoomY=a),null!=j&&(j.zoomY=a)}}),Object.defineProperty(this,"visible",{get:function(){return h.visible},set:function(a){h.visible=a,null!=i&&(i.visible=a),null!=j&&(j.visible=a)}}),Object.defineProperty(this,"opacity",{get:function(){return h.opacity},set:function(a){h.opacity=a,null!=i&&(i.opacity=a),null!=j&&(j.opacity=a)}}),Object.defineProperty(this,"width",{get:function(){return h.width},set:function(){}}),Object.defineProperty(this,"height",{get:function(){return h.height},set:function(){}}),this.fade=function(a,b,c){h.fade(a,b,c),null!=i&&i.fade(a,b,c),null!=j&&j.fade(a,b,c)},this.fadeTo=function(a,b){h.fadeTo(a,b),null!=i&&i.fadeTo(a,b),null!=j&&j.fadeTo(a,b)},this.slide=function(a,b,c,d,e){h.slide(a,b,c,d,e),null!=i&&i.slide(a,b,c,d,e),null!=j&&j.sslide(a,b,c,d,e)},this.slideTo=function(a,b,c){h.slideTo(a,b,c),null!=i&&i.slideTo(a,b,c),null!=j&&j.slideTo(a,b,c)},this.scale=function(a,b,c,d,e){h.scale(a,b,c,d,e),null!=i&&i.scale(a,b,c,d,e),null!=j&&j.scale(a,b,c,d,e)},this.scaleTo=function(a,b,c){h.scaleTo(a,b,c),null!=i&&i.scaleTo(a,b,c),null!=j&&j.scaleTo(a,b,c)},this.setAction=function(){h.addAction.apply(h,arguments),null!=i&&i.addAction.apply(i,arguments),null!=j&&j.addAction.apply(j,arguments)},this.setActLoop=function(a){h.actionLoop=a,null!=i&&(i.actionLoop=a),null!=j&&(j.actionLoop=a)},this.getActLoop=function(){return h.actionLoop},this.update=function(){var a,b,c;return l?h.visible?(a=h.isSelectTouch(),2==a?(null!=this.click&&this.click.play(),!0):(m=o||1==a,-1==w?(b=f[m?1:0],b!=h.getBitmap()&&h.setBitmap(b)):0==w&&(c=m?x:1,h.zoomX!=c&&(h.zoomX=h.zoomY=c,null!=i&&(i.zoomX=i.zoomY=c),null!=j&&(j.zoomX=j.zoomY=c))),!1)):!1:!1}}function ICheck(a,b,c,d,e){function o(){if(l!=k||m!=this.mouseOn)if(k)h.setBitmap(f[1]),m=this.mouseOn,l=k;else{var a=f[this.mouseOn?1:0];a!=h.getBitmap()&&h.setBitmap(a),m=this.mouseOn,l=k}}var k,l,m,n,f=[],g=[],h=null,i=c,j=null;this.mouseOn=!1,k=!1,l=!1,m=!1,this.tag=null,this.click=IVal.dSound,void 0==c&&(i=""),i=c,void 0==d&&(d=null),void 0==e&&(e=!1),k=e,f=[a,b],this.drawTitle=function(a,b,c){var d,e;void 0==b&&(b=-1),void 0==c&&(c=-1),j.clearBitmap(),d=IFont.getWidth(a,IVal.FontSize),e=IFont.getHeight(a,IVal.FontSize),-1==b&&-1==c?j.drawText(a,(j.width-d)/2,(j.height-e)/2):j.drawText(a,b,c),j.updateBitmap()},this.drawTitleQ=function(a,b,c){var d,e;j.clearBitmap(),d=IFont.getWidth(a,c),e=IFont.getHeight(a,c),j.drawTextQ(a,(j.width-d)/2,(j.height-e)/2,b,c),j.updateBitmap()},n=this,Object.defineProperty(this,"onload",{set:function(a){h.onload=function(){i.length>0&&(j.width=h.width,j.height=h.height,n.drawTitleQ(i,IVal.FontColor,IVal.FontSize)),a(n)}}}),h=new ISprite(k?f[0]:f[1],d),l=!1,m=!1,i.length>0&&(j=new ISprite(IBitmap.CBitmap(h.width,h.height),d),n.drawTitleQ(i,IVal.FontColor,IVal.FontSize)),this.getX=function(){return h.x},this.getY=function(){return h.y},this.setX=function(a){h.x=a,null!=j&&(j.x=a)},this.setY=function(a){h.y=a,null!=j&&(j.y=a)},this.setZ=function(a){h.z=a,null!=j&&(j.z=a+1)},this.getWidth=function(){return h.width},this.getHeight=function(){return h.height},this.getText=function(){return j},this.getBack=function(){return h},this.setVisible=function(a){h.visible=a,null!=j&&(j.visible=a)},this.setOpacity=function(a){h.opacity=a,null!=j&&(j.opacity=a)},Object.defineProperty(this,"x",{get:function(){return h.x},set:function(a){h.x=a,null!=j&&(j.x=a)}}),Object.defineProperty(this,"y",{get:function(){return h.y},set:function(a){h.y=a,null!=j&&(j.y=a)}}),Object.defineProperty(this,"z",{get:function(){return h.z},set:function(a){h.z=a,null!=j&&(j.z=a+1)}}),Object.defineProperty(this,"zoomX",{get:function(){return h.zoomX},set:function(a){h.zoomX=a,null!=j&&(j.zoomX=a)}}),Object.defineProperty(this,"zoomY",{get:function(){return h.zoomY},set:function(a){h.zoomY=a,null!=j&&(j.zoomY=a)}}),Object.defineProperty(this,"visible",{get:function(){return h.visible},set:function(a){h.visible=a,null!=j&&(j.visible=a)}}),Object.defineProperty(this,"opacity",{get:function(){return h.opacity},set:function(a){h.opacity=a,null!=j&&(j.opacity=a)}}),Object.defineProperty(this,"width",{get:function(){return h.width},set:function(){}}),Object.defineProperty(this,"height",{get:function(){return h.height},set:function(){}}),this.fade=function(a,b,c){h.fade(a,b,c),null!=j&&j.fade(a,b,c)},this.fadeTo=function(a,b){h.fadeTo(a,b),null!=j&&j.fadeTo(a,b)},this.slide=function(a,b,c,d,e){h.slide(a,b,c,d,e),null!=j&&j.slide(a,b,c,d,e)},this.slideTo=function(a,b,c){h.slideTo(a,b,c),null!=j&&j.slideTo(a,b,c)},this.scale=function(a,b,c,d,e){h.scale(a,b,c,d,e),null!=j&&j.scale(a,b,c,d,e)},this.scaleTo=function(a,b,c){h.scaleTo(a,b,c),null!=j&&j.scaleTo(a,b,c)},this.setAction=function(){h.addAction.apply(h,arguments),null!=j&&j.addAction.apply(j,arguments)},this.width=function(){return sprBack.width},this.height=function(){return sprBack.height},this.setZoomX=function(a){h.zoomX=a,null!=j&&(j.zoomX=a)},this.setZoomY=function(a){h.zoomY=a,null!=j&&(j.zoomY=a)},this.setActLoop=function(a){h.actionLoop=a,null!=j&&(j.actionLoop=a)},this.getActLoop=function(){return h.actionLoop},this.setOtherCheck=function(a){g=a},this.dispose=function(){null!=j&&j.dispose(),null!=f[0]&&(f[0]=null),null!=f[1]&&(f[1]=null),f=[],h.dispose()},this.disposeMin=function(){null!=j&&j.disposeMin(),h.disposeMin()},this.setSelected=function(a){k=a},this.clickBox=function(){if(null!=g)for(var a=0;a<g.length;a++)g[a].setSelected(!1);null!=this.click&&this.click.play(),k=!0},this.isClick=function(){return this.mouseOn},this.isMouseOn=function(){return h.isSelect()&&IInput.up},this.update=function(){return h.visible?(o(),this.mouseOn=2==h.isSelectTouch(),this.mouseOn?(this.clickBox(),!0):!1):void 0}}function IColor(){if(this.R=0,this.G=0,this.B=0,this.A=0,1==arguments.length){var a=arguments[0].split(",");4==a.length?(this.R=parseInt(a[0]),this.G=parseInt(a[1]),this.B=parseInt(a[2]),this.A=parseInt(a[3])):3==a.length&&(this.R=parseInt(a[0]),this.G=parseInt(a[1]),this.B=parseInt(a[2]),this.A=255)}else 4==arguments.length?(this.R=arguments[0],this.G=arguments[1],this.B=arguments[2],this.A=arguments[3]):3==arguments.length&&(this.R=arguments[0],this.G=arguments[1],this.B=arguments[2],this.A=255);this.JColor=function(){var a=parseFloat(this.A)/255;return"rgba("+this.R+","+this.G+","+this.B+","+a+")"},this.TColor=function(){return"\\c["+this.R+","+this.G+","+this.B+"]"}}function IDraw(a){var b,c,d;this.plane=IPlane,this.plane(),delete this.plane,b=this,c=[],this.width=1,this.height=1,this.lighter=!1,this.black=!1,d=cont,this.viewport=a,this.fbox=null==a?box:a.zbox,this.fbox.add(this),this.mode=IDraw.colorMode.none,this.drawRect=function(a,d,e){var f=new IRect(0,0,d,e);c.push({type:0,color:a,rect:f}),d>b.width&&(b.width=d),e>b.height&&(b.height=e)},this.drawLineGra=function(a,e,f,g,h,i,j){var m,k=new IRect(0,0,i,j),l=d.createLinearGradient(a,e,f,g);for(m=0;m<h.length;m++)l.addColorStop(h[m].num,h[m].color.JColor());c.push({type:1,grd:l,rect:k}),i>b.width&&(b.width=i),j>b.height&&(b.height=j)},this.drawRadialGra=function(a,e,f,g,h,i,j,k,l){var o,m=d.createRadialGradient(a,e,f,g,h,i),n=new IRect(0,0,k,l);for(o=0;o<j.length;o++)m.addColorStop(j[o].num,j[o].color.JColor());c.push({type:2,grd:m,rect:n}),k>b.width&&(b.width=k),l>b.height&&(b.height=l)},this.AllImage=function(a,b,d){var e=new IRect(0,0,b,d);c.push({type:3,image:a,rect:e})},this.update=function(){var a,b,e,f,g,h,i;if(this.updatebase(),a=null!=this.viewport?this.viewport.GetRect():new IRect(0,0,IVal.GWidth,IVal.GHeight),this.opacity>0&&this.visible){if(b=this.x,e=this.y,null!=this.viewport&&(b+=this.viewport.x+this.viewport.ox,e+=this.viewport.y+this.viewport.oy),f=new IRect(b,e,b+this.width*this.zoomX,e+this.height*this.zoomY),g=f.intersects(a),0==g)return;for(IVal.updateNumSp+=1,d.save(),d.globalCompositeOperation=this.mode,d.translate(b,e),d.rotate(Math.PI/180*this.angle),d.scale(this.zoomX,this.zoomY),d.globalAlpha=this.opacity,h=0;h<c.length;h++)i=c[h],0==i.type?(d.fillStyle=i.color,d.fillRect(i.rect.left,i.rect.top,i.rect.width,i.rect.height)):1==i.type?(d.fillStyle=i.grd,d.fillRect(i.rect.left,i.rect.top,i.rect.width,i.rect.height)):2==i.type?(d.fillStyle=i.grd,d.fillRect(i.rect.left,i.rect.top,i.rect.width,i.rect.height)):3==i.type&&(d.fillStyle=d.createPattern(i.image,"repeat"),d.rect(i.rect.left,i.rect.top,i.rect.width,i.rect.height),d.fill());d.restore()}},this.clear=function(){c=[]},this.dispose=function(){this.fbox.remove(this),c=[]}}function IFont(){}function IInput(){}function IParticle(a,b,c,d,e){var g,h,i,j,f=[];for(this.line=0,this.dir=0,this.rect=new IRect(0,0,10,10),this.radii=10,this.x=0,this.y=0,g=d,h=c,i=0,j=0;b>j;j++)f[j]=new ISprite(a[i],e),f[j].x=this.rect.left+rand(0,this.rect.width),f[j].y=this.rect.top+rand(0,this.rect.height),f[j].opacity=0,1==d&&(f[j].yx=.5,f[j].yy=.5),i=j%a.length;this.changeParticle=function(a,b,c,d,e){for(var j=0;j<f.length;j++)f[j].disposeMin();for(i=0,g=d,h=c,f=new Array(b),j=0;j<f.length;j++)f[j]=new ISprite(a[i],e),f[j].x=this.rect.left+rand(0,this.rect.width),f[j].y=this.rect.top+rand(0,this.rect.height),f[j].opacity=0,i=j%a.length},Object.defineProperty(this,"z",{get:function(){return f[0].z},set:function(a){for(var b=0;b<f.length;b++)f[b].z=a}}),this.dispose=function(){for(var a=0;a<f.length;a++)f[a].dispose();f=null},this.play=function(){var a,b,c,d,e,i;if(null!=f)for(a=0;a<f.length;a++)if(!f[a].isAnim())if(0==g)switch(b=h/2+rand(0,h),f[a].opacity=1,f[a].fadeTo(0,b),f[a].x=this.rect.left+rand(0,this.rect.width),f[a].y=this.rect.top+rand(0,this.rect.height),f[a].zoomY=f[a].zoomX=1-.5*Math.random(),this.dir){case 0:f[a].slideTo(f[a].x,f[a].y-this.line,b);break;case 1:f[a].slideTo(f[a].x,f[a].y+this.line,b);break;case 2:f[a].slideTo(f[a].x-this.line,f[a].y,b);break;case 3:f[a].slideTo(f[a].x+this.line,f[a].y,b);break;case 4:f[a].slideTo(f[a].x-this.line,f[a].y-this.line,b);break;case 5:f[a].slideTo(f[a].x+this.line,f[a].y-this.line,b);break;case 6:f[a].slideTo(f[a].x-this.line,f[a].y+this.line,b);break;case 7:f[a].slideTo(f[a].x+this.line,f[a].y+this.line,b)}else 1==g&&(c=rand(0,360),d=Math.PI*c/180,e=this.x+parseInt(Math.cos(d)*this.radii),i=this.y+parseInt(Math.sin(d)*this.radii),f[a].opacity=1,f[a].angle=rand(0,360),b=h/2+rand(0,h),f[a].slide(this.x,this.y,e,i,b),f[a].fadeTo(0,b),f[a].zoomY=f[a].zoomX=1-.5*Math.random(),f[a].scaleTo(.1,.1,b))},this.update=function(){this.play()}}function IPlane(){function W(){0==L.visible||0>=f||(f-=1,0>=f?(L.opacity=g,null!=P&&L.actionList.length<=0&&P(L)):(i+=h,L.opacity=i))}function X(){0>=q||(q-=1,0>=q?(L.x=r,L.y=s,null!=U&&L.actionList.length<=0&&U(L)):(v+=t,w+=u,L.x=v,L.y=w))}function Y(){0>=j||(j-=1,0>=j?(L.zoomX=k,L.zoomY=l,null!=T&&L.actionList.length<=0&&T(L)):(o+=m,p+=n,L.zoomX=o,L.zoomY=p))}function Z(){0!=x&&(L.angle=(L.angle+x)%720)}function $(){0>=B||(B-=1,0>=B?(L.angle=z,null!=S&&L.actionList.length<=0&&S(L)):(y+=A,L.angle=y))}function _(){0>=b||(b-=1,0>=b?L.color.A=c:(e+=d,L.color.A=e))}function ab(){if(!(0>=K)){K-=1,0>=K&&null!=R&&L.actionList.length<=0&&R(L),H+=G;var a=int(C*H*H+D-I);J?L.x+=G:L.x-=G,L.y=E+a}}function bb(){var d,a=arguments[0],b=a[0],c=[];for(d=1;d<a.length;d++)c[d-1]=a[d];this.doThis=function(){switch(b){case 4:L.wait=c[0];break;case 2:3==c.length?L.slideTo(c[0],c[1],c[2]):5==c.length&&L.slide(c[0],c[1],c[2],c[3],c[4]);break;case 5:3==c.length?L.scaleTo(c[0],c[1],c[2]):5==c.length&&L.scale(c[0],c[1],c[2],c[3],c[4]);break;case 1:2==c.length?L.fadeTo(c[0],c[1]):3==c.length&&L.fade(c[0],c[1],c[2]);break;case 3:1==c.length?L.startRotate(c[0]):2==c.length?L.rotateTo(c[0],c[1]):3==c.length&&L.rotate(c[0],c[1],c[2])}}}var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;this.fbox=null,this.x=0,this.y=0,a=0,this.zoomX=1,this.zoomY=1,this.angle=0,this.opacity=1,this.visible=!0,this.mirror=!1,this.tempZ=0,this.wait=0,this.actionList=[],this.tempActionList=[],this.actionLoop=!1,this.color=IColor.Transparent(),this.speedX=0,this.aSpeedX=0,this.speedY=0,this.aSpeedY=0,b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=!1,K=0,this.tag=null,L=this,M=!1,Object.defineProperty(this,"z",{get:function(){return a},set:function(a){null!=L.fbox&&L.fbox.setZ(L,a)}}),this.updatebase=function(){var a,b;if(!M){if(_(),W(),Y(),X(),Z(),$(),ab(),this.wait>0)return this.wait-=1,this.wait<=0&&null!=V&&V(L),void 0;if(this.actionList.length>0&&(this.actionList[0].doThis(),this.actionList.splice(0,1),null!=O&&this.actionList.length<=0&&O(L),0==this.actionList.length&&null!=N&&this.actionList.length<=0&&N(L)),this.actionLoop&&0==this.actionList.length)for(a=0;a<this.tempActionList.length;a++)b=this.tempActionList[a],this.actionList.push(b)}},this.endAction=function(){this.actionList=[],this.tempActionList=[],this.actionLoop=!1},this.isAnim=function(){return f>0||q>0||j>0||B>0||this.wait>0||this.actionList.length>0},this.pauseAnim=function(){f=0,q=0,j=0,B=0,b=0,this.wait=0,this.actionList=[],this.stopRotate()},this.pause=function(){M=!0},this.restart=function(){M=!1},this.isPause=function(){return M},this.stopAnim=function(){f>0&&(f=0,this.opacity=g),q>0&&(q=0,this.x=r,this.y=s),j>0&&(j=0,this.zoomX=k,this.zoomY=l),B>0&&(B=0,this.angle=z),b>0&&(b=0,this.color.A=0),this.stopRotate()},this.setZ=function(b){a=b},this.updateZ=function(){return this.tempZ=this.z},this.getOldZ=function(){return this.tempZ},this.isNoZ=function(a){return this.tempZ==a},this.fade=function(a,b,c){0>=c?this.opacity=b:(f=c,g=b,h=(b-a)/parseFloat(c),i=a,this.opacity=a)},this.fadeTo=function(a,b){this.fade(this.opacity,a,b)},this.slide=function(a,b,c,d,e){0>=e?(this.x=c,this.y=d):(q=e,r=c,s=d,t=(r-a)/parseFloat(e),u=(s-b)/parseFloat(e),v=a,w=b,this.x=a,this.y=b)},this.slideTo=function(a,b,c){this.slide(this.x,this.y,a,b,c)},this.scale=function(a,b,c,d,e){0>=e?(this.zoomX=a,this.zoomY=b):(j=e,k=c,l=d,m=(k-a)/parseFloat(e),n=(l-b)/parseFloat(e),o=a,p=b,this.zoomX=a,this.zoomY=b)},this.scaleTo=function(a,b,c){this.scale(this.zoomX,this.zoomY,a,b,c)},this.startRotate=function(a){x=a},this.stopRotate=function(){x=0},this.rotate=function(a,b,c){0>=c?this.angle=b:(B=c,z=b,A=(b-a)/(1*c),0==A&&(A=1,B=0),y=a,this.angle=a)},this.rotateTo=function(a,b){this.rotate(this.angle,a,b)},this.flash=function(a,f){0>=f?this.color=IColor.Transparent():(this.color=a,b=f,c=0,d=(c-a.A)/parseFloat(f),e=a.A,this.color.A=e)},this.parabola=function(a,b,c,d,e){C=a,D=b,E=this.y,F=-1*Math.sqrt(D/C),J=d,K=c,H=-Math.abs(F),G=Math.abs(F)*(2+e)/K,I=C*H*H+D},this.addAction=function(){var a=new bb(arguments);this.actionList.push(a),this.tempActionList.push(a)},this.setOnEndSlide=function(a){U=a},this.setOnEndFade=function(a){P=a},this.setOnEndScale=function(a){T=a},this.setOnEndRotae=function(a){S=a},this.setOnEndFlash=function(a){Q=a},this.setOnEndParabola=function(a){R=a},this.setOnEndActionOne=function(a){O=a},this.setOnEndAction=function(a){N=a},this.setOnEndWait=function(a){V=a}}function IRect(a,b,c,d){var e=this;this.left=a,this.top=b,this.right=c,this.bottom=d,Object.defineProperty(this,"centerX",{get:function(){return parseInt(e.left+e.width/2)}}),Object.defineProperty(this,"centerY",{get:function(){return parseInt(e.top+e.height/2)}}),Object.defineProperty(this,"x",{get:function(){return e.left},set:function(a){var b=e.width;e.left=a,e.right=a+b}}),Object.defineProperty(this,"y",{get:function(){return e.top},set:function(a){var b=e.height;e.top=a,e.bottom=a+b}}),Object.defineProperty(this,"width",{get:function(){return e.right-e.left},set:function(a){e.right=e.left+a}}),Object.defineProperty(this,"height",{get:function(){return e.bottom-e.top},set:function(a){e.bottom=e.top+a}}),this.intersects=function(){var b,c,a=null;return 1==arguments.length?a=arguments[0]:4==arguments.length&&(a=new IRect(arguments[0],arguments[1],arguments[2],arguments[3])),null==a?!1:(b=a,c=this,!(b.left>c.right||b.top>c.bottom||c.left>b.right||c.top>b.bottom))},this.contains=function(){var b,a=null;return 1==arguments.length?a=arguments[0]:4==arguments.length&&(a=new IRect(arguments[0],arguments[1],arguments[2],arguments[3])),b=!1,this.width>=a.width&&this.height>=a.height?b=!0:a.width>=this.width&&a.height>=this.right?b=!1:a=null,null!=a?b?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom>=this.bottom:this.left>=a.left&&this.right<=a.right&&this.top>=a.top&&this.bottom>=a.bottom:null==a?!1:void 0}}function IRWFile(a,b,c,d){var e,f,g,h;void 0!=a&&(null==b&&(b=0),e=new ArrayBuffer,this.onload=null,f=null,g=this,h=new XMLHttpRequest,h.open("GET",a,!0),null!=c&&h.overrideMimeType("text/html;charset="+c),h.responseType=0==b?"arraybuffer":"text",h.onload=function(){if(0==b){var c=h.response;c&&(e=c),f=new DataStream(e),null!=g.onload&&g.onload()}else null!=g.onload&&g.onload(h.response,d)},h.send(null),this.readShort=function(){return f.readInt16()},this.readInt=function(){return f.readInt32()},this.readLong=function(){return f.readFloat64()},this.readString=function(){return f.readStringE()},this.readBool=function(){var a=f.readInt8();return 0!=a},this.readMS=function(a){return f.readString(a,"UTF-8")})}function IScrollbar(a,b,c,d,e,f,g){function C(){0>=A||(A-=1,0==u?0>=A?q=y:(x+=z,q=parseInt(x)):1==u&&(0>=A?r=y:(x+=z,r=parseInt(x))))}function D(){if(!(0==l.height&&0==l.width||s==q&&v==w)){v=w,s=q;var a=Math.min(w,q);1==B.dir?(h.x=parseInt(k.x+l.width-l.width*a/w),h.ox=parseInt(-(l.width-l.width*a/w)),h.width=parseInt(l.width*a/w)):2==B.dir?(h.width=l.width,h.height=parseInt(l.height*a/w)):3==B.dir?(h.width=l.width,h.y=parseInt(k.y+l.height-l.height*a/w),h.oy=parseInt(-(l.height-l.height*a/w)),h.height=parseInt(l.height*a/w)):h.width=parseInt(l.width*a/w)}}function E(){if(!(0==l.height&&0==l.width||t==r&&v==w)){v=w,t=r;var a=Math.min(w,r);1==B.dir?(i.x=parseInt(k.x+l.width-l.width*a/w),i.ox=parseInt(-(l.width-l.width*a/w)),i.width=parseInt(l.width*a/w)):2==B.dir?(i.width=l.width,i.height=parseInt(l.height*a/w)):3==B.dir?(i.width=l.width,i.y=parseInt(k.y+l.height-l.height*a/w),i.oy=parseInt(-(l.height-l.height*a/w)),i.height=parseInt(l.height*a/w)):i.width=parseInt(l.width*a/w)}}var s,t,u,v,w,x,y,z,A,B,h=null,i=null,j=[],k=null,l=null,m=null,n=null,o=0,p=0,q=0,r=0;this.dir=0,s=-1,t=-1,u=0,v=0,w=0,x=0,y=0,z=0,A=0,this.tag=null,B=this,void 0!=a&&void 0!=b&&null!=a&&null!=b&&(j=[a,b],q=c||0,w=d||100,h=new IViewport(0,0,j[0].width,j[0].height+5,e),i=new IViewport(0,0,j[0].width,j[0].height+5,e),k=new ISprite(j[0],e),l=new ISprite(j[1],h),null!=f&&(m=new ISprite(f,i)),null!=g&&(n=new ISprite(g,e)),j[1].complete?(h.width=j[1].width,h.height=j[1].height+5,i.width=j[1].width,i.height=j[1].height,l.width=j[1].width,l.height=j[1].height,l.onload=function(){},D()):j[1].onload=function(){h.width=j[1].width,h.height=j[1].height+5,i.width=j[1].width,i.height=j[1].height,l.width=j[1].width,l.height=j[1].height,l.onload=function(){},D()},Object.defineProperty(this,"onload",{set:function(a){k.onload=function(){a(B)}}}),D(),this.setIconPoint=function(a,b){o=a,p=b,B.setX(B.getX()),B.setY(B.getY())},this.setX=function(a){k.x=a,h.x=a,null!=m&&(i.x=a),null!=n&&(n.x=a+o)},this.getX=function(){return k.x},this.setY=function(a){k.y=a,h.y=a,null!=m&&(i.y=a),null!=n&&(n.y=a+p)},this.getY=function(){return k.y},this.setZ=function(a){k.z=a,l.z=a+3,h.z=a+3,null!=m&&(i.z=a+2),null!=n&&(n.z=a+5)},Object.defineProperty(this,"x",{get:function(){return k.x},set:function(a){B.setX(a)}}),Object.defineProperty(this,"y",{get:function(){return k.y},set:function(a){B.setY(a)}}),Object.defineProperty(this,"z",{get:function(){return k.z},set:function(a){B.setZ(a)}}),Object.defineProperty(this,"zoomX",{get:function(){return k.zoomX},set:function(a){k.zoomX=a,null!=h&&(h.zoomX=a),null!=m&&(m.zoomX=a),null!=n&&(n.zoomX=a)}}),Object.defineProperty(this,"zoomY",{get:function(){return k.zoomY},set:function(a){k.zoomY=a,null!=h&&(h.zoomY=a),null!=m&&(m.zoomY=a),null!=n&&(n.zoomY=a)}}),Object.defineProperty(this,"visible",{get:function(){return k.visible},set:function(a){k.visible=a,null!=h&&(h.visible=a),null!=m&&(m.visible=a),null!=n&&(n.visible=a)}}),Object.defineProperty(this,"opacity",{get:function(){return k.opacity},set:function(a){B.setOpactiy(a)}}),Object.defineProperty(this,"width",{get:function(){return k.width},set:function(){}}),Object.defineProperty(this,"height",{get:function(){return k.height},set:function(){}}),this.width=function(){return k.width},this.height=function(){return k.height},this.setOpactiy=function(a){k.opacity=a,l.opacity=a,null!=m&&(m.opacity=a),null!=n&&(n.opacity=a)},this.fade=function(a,b,c){k.fade(a,b,c),null!=l&&l.fade(a,b,c),null!=i&&i.fade(a,b,c),null!=n&&n.fade(a,b,c)},this.fadeTo=function(a,b){k.fadeTo(a,b),null!=l&&l.fadeTo(a,b),null!=i&&i.fadeTo(a,b),null!=n&&n.fadeTo(a,b)},this.slide=function(a,b,c,d,e){k.slide(a,b,c,d,e),null!=h&&h.slide(a,b,c,d,e),null!=i&&i.slide(a,b,c,d,e),null!=n&&n.slide(a,b,c,d,e)},this.slideTo=function(a,b,c){k.slideTo(a,b,c),null!=h&&h.slideTo(a,b,c),null!=i&&i.slideTo(a,b,c),null!=n&&n.slideTo(a,b,c)},this.scale=function(a,b,c,d,e){k.scale(a,b,c,d,e),null!=h&&h.scale(a,b,c,d,e),null!=i&&i.scale(a,b,c,d,e),null!=n&&n.scale(a,b,c,d,e)},this.scaleTo=function(a,b,c){k.scaleTo(a,b,c),null!=h&&h.scaleTo(a,b,c),null!=i&&i.scaleTo(a,b,c),null!=n&&n.scaleTo(a,b,c)},this.setAction=function(){k.addAction.apply(k,arguments),null!=h&&h.addAction.apply(h,arguments),null!=i&&i.addAction.apply(i,arguments),null!=n&&n.addAction.apply(n,arguments)},this.setActLoop=function(a){k.actionLoop=a,null!=h&&(h.actionLoop=a),null!=i&&(i.actionLoop=a),null!=n&&(n.actionLoop=a)},this.getActLoop=function(){return k.actionLoop},this.dispose=function(){this.disposeMin(),h.dispose(),i.dispose(),null!=j[0]&&(j[0]=null),null!=j[1]&&(j[1]=null),j=[]},this.disposeMin=function(){k.disposeMin(),l.disposeMin(),null!=m&&m.disposeMin(),null!=n&&n.disposeMin()},this.setValue=function(a,b){q=a,w=b},this.isClick=function(){if(!k.visible)return!1;var a=IInput.up&&k.isSelect();return a&&(IInput.up=!1),a},this.update=function(){k.visible&&(C(),D(),E())},this.touchValue=function(){IInput.y>k.y&&IInput.y<=k.y+k.height&&IInput.x>=k.x&&IInput.x<=k.x+k.width&&(q=(IInput.x-k.x)*w/k.width)},this.valueAnim=function(a,b,c){a>b?(u=1,q=b,0>=c?r=b:(A=c,y=b,z=(b-a)/c,x=a,r=a)):(u=0,r=b,0>=c?q=b:(A=c,y=b,z=(b-a)/c,x=a,q=a))},this.valueAnimTo=function(a,b){this.valueAnim(q,a,b)})}function ISound(a,b){var c=a;this.play=function(){void 0==c||c.length<=0||IAudio.playSE(c,b)}}function ISprite(a,b){function m(a,b,c,d,e,f,g,i){var m,q,r,s,t,u,v,j=n(a),k=b,l=c;for(p(),i.font=IVal.FontSize+"px "+IVal.FontName,m=IVal.FontColor,i.fillStyle=m.JColor();;){if(j.length<=0)break;q=j.substring(0,1),j=j.substring(1,j.length),r=q.charCodeAt(0),6e4==r?(k=b,l+=1.5*cont.measureText("七").width,l=parseInt(l)):60001==r?(s=o(j,"[","]","\\[([0-9]+[,][0-9]+[,][0-9]+)]"),m=new IColor(s.over),j=s.main):60002==r?(s=o(j,"[","]","\\[([0-9]+)]"),i.font=s.over+"px "+IVal.FontName,j=s.main):60003==r?(s=o(j,"[","]","\\[([/.a-zA-Z0-9_-]+)]"),null==h[s.over]&&(h[s.over]=IBitmap.WBitmap(IVal.baseBPath+s.over)),t=h[s.over],i.drawImage(t,k,l),u=t.width,0==t.width&&(u=36),k+=u,j=s.main):(v=l+cont.measureText("七").width,i.fillStyle=m.JColor(),i.fillText(q,k,v),void 0!=e&&(i.fillStyle=e.JColor()),1==d?i.fillText(q,k+1,v+1):2==d&&(i.fillText(q,k+1,v),i.fillText(q,k+1,v+1),i.fillText(q,k,v+1),i.fillText(q,k-1,v+1),i.fillText(q,k-1,v),i.fillText(q,k-1,v-1),i.fillText(q,k,v-1),i.fillText(q,k+1,v-1)),k+=cont.measureText(q).width,f&&k>=g&&(j=String.fromCharCode(6e4)+j))}}function n(a){var b=new String(a);return b=b.replaceAll("\\\\[Nn]",String.fromCharCode(6e4)),b=b.replaceAll("\\\\[Cc]\\[([0-9]+,[0-9]+,[0-9]+)]",String.fromCharCode(60001)+"[$1]"),b=b.replaceAll("\\\\[Ss]\\[([0-9]+)]",String.fromCharCode(60002)+"[$1]"),b=b.replaceAll("\\\\[Bb]\\[([/.a-zA-Z0-9_-]+)]",String.fromCharCode(60003)+"[$1]")}function o(a,b,c,d){var f,g,h,e=a.substring(a.indexOf(b)+1,a.indexOf(c));return a=a.substring(e.length+b.length+c.length,a.length),f=e.replaceAll(d,"$1"),g=f.replaceAll(" ",""),h=g.replaceAll(" , ",","),{over:h,main:a}}function p(){}var c,d,e,f,g,h,i,j,k,l;this.plane=IPlane,this.plane(),delete this.plane,this.width=0,this.height=0,this.lighter=!1,this.RWidth=0,this.RHeight=0,this.yy=0,this.yx=0,this.image=null,this.tempimage=null,this.tiling=!1,this.viewport=null,this.activity=!1,c=this,d=!1,e=!1,f=null,g=[],h={},i=-2,j=!1,k=new IRect(1,1,1,1),l=new IRect(0,0,1,1),Object.defineProperty(this,"onload",{set:function(b){return null==c.image?(b(c),void 0):(c.image.complete?(c.width=a.width,c.height=a.height,d=!0,a.onload=null,b(c)):c.image.onload=function(){c.width=a.width,c.height=a.height,d=!0,a.onload=null,b(c)},void 0)}}),arguments.length>=3?(this.image=new Image,this.image.src=tcanvas.toDataURL("image/png"),this.width=arguments[0],this.height=arguments[1],g.push({tp:3,rect:new IRect(0,0,arguments[0],arguments[1]),color:arguments[2]})):(void 0!=b&&b instanceof IViewport&&(this.viewport=b),a instanceof CBmp?(this.image=null,this.width=a.width,this.height=a.height):a instanceof IBCof?(f=a,this.image=f.bitmap,this.width=f.width,this.height=f.height,e=!0):(this.image=a,this.image.complete?(this.width=this.image.width,this.height=this.image.height,d=!0):a.onload=function(){c.width=a.width,c.height=a.height,a.onload=null,d=!0})),this.fbox=null==this.viewport?box:this.viewport.zbox,this.fbox.add(this),this.update=function(){var a,b,d,h,i,j,k,n;
if(this.updatebase(),c.speedX+=c.aSpeedX,c.speedY+=c.aSpeedY,c.x+=c.speedX,c.y+=c.speedY,this.activity=!1,a=null!=this.viewport?this.viewport.GetRect():IVal.SceneRect,this.opacity>0&&this.visible){if(0==this.width&&0==this.height){if(null==this.image||!this.image.complete)return;this.width=this.image.width,this.height=this.image.height}if(b=this.width*this.yx,d=this.height*this.yy,h=this.x-b,i=this.y-d,null!=this.viewport&&(h+=this.viewport.x+this.viewport.ox,i+=this.viewport.y+this.viewport.oy),c.tiling&&(this.width=this.RWidth,this.height=this.RHeight),l.left=h,l.top=i,l.right=h+this.width*this.zoomX,l.bottom=i+this.height*this.zoomY,j=l.intersects(a),0==j)return;for(this.activity=!0,IVal.updateNumSp+=1,cont.save(),cont.globalCompositeOperation=c.lighter?"lighter":"destination-over",cont.translate(h+b,i+d),cont.rotate(Math.PI/180*this.angle),cont.scale(this.zoomX,this.zoomY),cont.translate(-b,-d),cont.globalAlpha=null!=this.image&&"tg"==this.image.alt?.6*this.opacity:this.opacity,this.mirror&&cont.transform(-1,0,0,1,this.width,0),k=g.length-1;k>=0;k--)n=g[k],1==n.tp?null!=n.bmp&&n.bmp instanceof Image&&n.bmp.complete&&cont.drawImage(n.bmp,n.x,n.y):2==n.tp?null!=n.bmp&&n.bmp instanceof Image&&n.bmp.complete&&cont.drawImage(n.bmp,n.x,n.y,n.width,n.height):3==n.tp?(cont.fillStyle=n.color.JColor(),cont.fillRect(n.rect.left,n.rect.top,n.rect.width,n.rect.height)):4==n.tp?(cont.fillStyle=n.color.JColor(),cont.font=n.size+"px "+IVal.FontName,cont.fillText(n.s,n.x,n.y+n.size)):5==n.tp?m(n.str,n.x,n.y,n.type,n.wcolor,n.isAutoL,n.size,cont):6==n.tp&&cont.drawImage(n.bCof.bitmap,n.bCof.x,n.bCof.y,n.bCof.width,n.bCof.height,n.x,n.y,n.bCof.width,n.bCof.height);null!=this.image&&this.image.complete&&(c.tiling?(this.width=this.RWidth,this.height=this.RHeight,cont.fillStyle=cont.createPattern(this.image,"repeat"),cont.rect(0,0,this.RWidth,this.RHeight),cont.fill()):e?cont.drawImage(f.bitmap,f.x,f.y,f.width,f.height,0,0,f.width,f.height):cont.drawImage(this.image,0,0,this.width,this.height)),c.color.A>0&&(cont.globalCompositeOperation="source-atop",cont.fillStyle=c.color.JColor(),e?cont.fillRect(0,0,f.width,f.height):cont.fillRect(0,0,c.width,c.height)),cont.restore()}},this.ListToImage=function(){var a,b,d;for(tcanvas.width=c.width,tcanvas.height=c.height,tcont.clearRect(0,0,c.width,c.height),null!=this.image&&this.image.complete&&(e?tcont.drawImage(f.bitmap,f.x,f.y,f.width,f.height,0,0,f.width,f.height):tcont.drawImage(this.image,0,0,this.width,this.height)),a=0;a<g.length;a++)b=g[a],1==b.tp?null!=b.bmp&&b.bmp instanceof Image&&b.bmp.complete&&tcont.drawImage(b.bmp,b.x,b.y):2==b.tp?null!=b.bmp&&b.bmp instanceof Image&&b.bmp.complete&&tcont.drawImage(b.bmp,b.x,b.y,b.width,b.height):3==b.tp?(tcont.fillStyle=b.color.JColor(),tcont.fillRect(b.rect.left,b.rect.top,b.rect.width,b.rect.height)):4==b.tp?(tcont.fillStyle=b.color.JColor(),tcont.font=b.size+"px "+IVal.FontName,tcont.fillText(b.s,b.x,b.y+b.size)):5==b.tp?m(b.str,b.x,b.y,b.type,b.wcolor,b.isAutoL,b.size,tcont):6==b.tp&&null!=b.bCof.bitmap&&tcont.drawImage(b.bCof.bitmap,b.bCof.x,b.bCof.y,b.bCof.width,b.bCof.height,b.x,b.y,b.bCof.width,b.bCof.height);d=new Image,d.src=tcanvas.toDataURL("image/png"),c.image=d,g=[]},this.clearBitmap=function(){g=[],h={}},this.updateBitmap=function(){},this.setXY=function(a,b){this.x=a,this.y=b},this.isSelect=function(a,b){var c,d,e,g,h,i;return null!=f&&(this.width=f.width,this.height=f.height),c=a,d=b,e=this.x-this.width*this.yx*this.zoomX,g=this.y-this.height*this.yy*this.zoomY,null==this.viewport?c>e&&c<=e+this.width*this.zoomX&&d>g&&d<=g+this.height*this.zoomY:c>=this.viewport.x&&c<=this.viewport.width+this.viewport.x&&d>=this.viewport.y&&d<=this.viewport.height+this.viewport.y?(h=this.viewport.x+this.viewport.ox+e,i=this.viewport.y+this.viewport.oy+g,c>h&&c<=h+this.width*this.zoomX&&d>i&&d<=i+this.height*this.zoomY):!1},this.isSelected=function(){return this.isSelect(IInput.x,IInput.y)},this.isSelectTouch=function(){var b,a=!1;for(b=0;b<IInput.touches.length;b++){if(this.isSelect(IInput.touches[b].clientX,IInput.touches[b].clientY))return i=IInput.touches[b].id,j=!0,1;IInput.touches[b].id==i&&(j=!1,a=!0)}return j&&0==a?(j=!1,i=-2,2):(j=!1,0)},this.drawRect=function(a,b){g.push({tp:3,rect:a,color:b})},this.drawTextQ=function(a,b,c,d,e){g.push({tp:4,s:ISprite.toRegular(a),x:b,y:c,color:d,size:e})},this.drawText=function(a,b,c,d,e,f,h){g.push({tp:5,str:ISprite.toRegular(a),x:b,y:c,type:d,wcolor:e,isAutoL:f,size:h})},this.drawBitmap=function(a,b,c,d){g.push({tp:1,bmp:a,x:b,y:c,isDispose:d})},this.drawBitmapRect=function(a,b,c){g.push({tp:2,bmp:a,x:b.left,y:b.top,width:b.width,height:b.height,isDispose:c})},this.drawBitmapBCof=function(a,b,c,d){g.push({tp:6,x:a,y:b,bCof:c,isDispose:d})},this.getBitmap=function(){return this.image},this.dispose=function(){this.disposeBitmap(),this.disposeMin()},this.disposeMin=function(){this.fbox.remove(this)},this.disposeBitmap=function(){g=[],h={},this.image=null,this.tempimage=null,f=null},this.setBCof=function(a){f=a,this.image=f.bitmap,this.width=f.width,this.height=f.height,e=!0},this.getBCof=function(){return f},this.setBitmap=function(a){null==a&&(this.width=100,this.height=100,c.drawRect(new IRect(0,0,100,100),IColor.Red()),c.drawTextQ("图片不存在",10,30,IColor.White(),20)),this.image=a},this.GetRect=function(){var a,b;return null!=f&&(this.width=f.width,this.height=f.height),a=this.x-this.width*this.yx*this.zoomX,b=this.y-this.height*this.yy*this.zoomY,k.left=a,k.top=b,k.right=a+this.width*this.zoomX,k.bottom=b+this.height*this.zoomY,k},this.getDrawList=function(){return g},this.setDrawList=function(a){g=a}}function IVal(){}function IViewport(a,b,c,d,e){function w(){0>=n||(n-=1,0>=n?(t.ox=j,t.oy=k):(h+=l,i+=m,t.ox=parseInt(h),t.oy=parseInt(i)))}function x(){var c,d,e,g,a=0,b=t.zbox.getAll();for(c in b)for(d=b[c],e=0;e<d.length;e++)g=0,g=d[e].x+d[e].width,g>a&&(a=g);f=a+t.endPosDX}function y(){var c,d,e,f,a=0,b=t.zbox.getAll();for(c in b)for(d=b[c],e=0;e<d.length;e++)f=0,f=d[e].y+d[e].height,f>a&&(a=f);g=a+t.endPosDY}function z(){var c,d,a=t.oy,b=g-t.height;return IInput.move&&t.IsIn()&&Math.abs(IInput.dy-IInput.y)>10&&(c=t.oy-(IInput.dy-IInput.y),d=b>0?-b-300:0,300>=c&&c>=d&&(t.isAutoMove||(c<t.height-g&&(c=t.height-g),c>0&&(c=0)),t.oy=c,IInput.dy=IInput.y,p=!0),Math.abs(a-t.oy)>0)?!0:(IInput.up&&p&&(p=!1,o=!0),!1)}function A(){var a,b,c;return IInput.move&&t.IsIn()&&Math.abs(IInput.dx-IInput.x)>10?(a=t.ox-(IInput.dx-IInput.x),b=f-t.width,c=b>0?-b-300:0,300>=a&&a>=c&&(t.isAutoMove||(a<t.width-f&&(a=t.width-f),a>0&&(a=0)),t.ox=a,IInput.dx=IInput.x,r=!0),!0):(r&&IInput.up&&(r=!1,q=!0),!1)}function B(){var a,b;return q?(a=30,b=f-t.width,t.ox>0?t.ox-a<=0?(t.ox=0,q=!1,!1):(t.ox-=a,!0):t.ox<-b?t.ox+a>=-b?(t.ox=-b,q=!1,!1):(t.ox+=a,!0):(q=!1,!1)):!1}function C(){var a,b;return o?(a=30,b=g-t.height,t.oy>0?t.oy-a<=0?(t.oy=0,o=!1,!1):(t.oy-=a,!0):t.oy<-b?t.oy+a>=-b?(t.oy=-b,o=!1,!1):(t.oy+=a,!0):(o=!1,!1)):!1}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;this.plane=IPlane,this.plane(),delete this.plane,this.width=0,this.height=0,this.ox=0,this.oy=0,this.dir=IViewport.Dir.None,this.type=IViewport.Type.Rectangle,this.eAngel=2*Math.PI,this.radius=c/2,this.isAutoMove=!1,this.endPosDX=0,this.endPosDY=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=!1,p=!1,q=!1,r=!1,s=new IRect(1,1,1,1),this.fviewporte=e,this.zbox=new IBox,t=this,this.fbox=null==this.fviewporte?box:this.fviewporte.zbox,this.fbox.add(this),u=0,v=0,Object.defineProperty(this,"x",{get:function(){return null!=t.fviewporte?u+t.fviewporte.x+t.fviewporte.ox:u},set:function(a){u=a}}),Object.defineProperty(this,"y",{get:function(){return null!=t.fviewporte?v+t.fviewporte.y+t.fviewporte.oy:v},set:function(a){v=a}}),a instanceof IRect?(this.x=a.left,this.y=a.top,this.width=a.width,this.height=a.height):(this.x=a,this.y=b,this.width=c,this.height=d),this.add=function(a){this.zbox.add(a)},this.updateMove=function(){if(this.dir==IViewport.Dir.Vertical||this.dir==IViewport.Dir.All){if(y(),z())return!0;if(this.isAutoMove&&C())return!0}if(this.dir==IViewport.Dir.Horizontal||this.dir==IViewport.Dir.All){if(x(),A())return!0;if(this.isAutoMove&&B())return!0}return!1},this.update=function(){var a,b;this.updatebase(),this.visible&&(w(),cont.save(),cont.beginPath(),a=this.x,b=this.y,this.type==IViewport.Type.Rectangle?(cont.lineTo(a,b),cont.lineTo(a+this.width,b),cont.lineTo(a+this.width,b+this.height),cont.lineTo(a,b+this.height)):this.type==IViewport.Type.Round&&cont.arc(a+this.radius,b+this.radius,this.radius,0,2*Math.PI,!1),cont.closePath(),cont.clip(),cont.scale(this.zoomX,this.zoomY),this.zbox.update(),cont.restore())},this.dispose=function(){this.fbox.remove(this)},this.IsIn=function(){var a=this.x,b=this.y,c=this.x+this.width,d=this.y+this.height;return IInput.x>=a&&IInput.x<=c&&IInput.y>=b&&IInput.y<=d},this.isShifting=function(){return n>0},this.shifting=function(a,b,c,d,e){0>=e?(this.ox=c,this.oy=d):(n=e,j=c,k=d,l=(c-a)/(1*e),m=(d-b)/(1*e),h=a,i=b,this.ox=a,this.oy=b)},this.shiftingTo=function(a,b,c){this.shifting(this.ox,this.oy,a,b,c)},this.GetRect=function(){return s.left=this.x,s.top=this.y,s.right=this.x+this.width/this.zoomX,s.bottom=this.y+this.height/this.zoomY,s}}function IWeb(){}function SText(){function b(){a.angle=0,a.zoomX=a.zoomY=1,a.opacity=1}function c(){a.tag="atk",a.endAction(),a.pauseAnim(),b(),a.addAction(action.rotate,90,60),a.addAction(action.wait,60),a.addAction(action.rotate,0,60),a.addAction(action.wait,60),a.setOnEndAction(function(){a.setOnEndAction(null),a.tag="none"})}function d(){a.tag="def",a.endAction(),a.pauseAnim(),b(),a.addAction(action.zoom,2,2,60),a.addAction(action.wait,60),a.addAction(action.zoom,1,1,60),a.addAction(action.wait,60),a.setOnEndAction(function(){a.setOnEndAction(null),a.tag="none"})}function e(){a.tag="mov",a.endAction(),a.pauseAnim(),b(),a.addAction(action.fade,1,0,60),a.addAction(action.wait,60),a.addAction(action.fade,0,1,60),a.addAction(action.wait,60),a.setOnEndAction(function(){a.setOnEndAction(null),a.tag="none"})}var f,g,a=new ISprite(IBitmap.ABitmap("1_back.png"));a.x=200,a.y=200,a.yx=.5,a.yy=.5,a.tag="none",f=[60,20,20],g=[0,1,2],this.update=function(){if("none"==a.tag){var b=RF.RandomChoose(g);RF.ProbabilityHit(f[b]/100)&&(0==b?c():1==b?d():2==b&&e())}"atk"!=a.tag&&IInput.isKeyDown(65)&&c(),"def"!=a.tag&&IInput.isKeyDown(83)&&d(),"mov"!=a.tag&&IInput.isKeyDown(68)&&e()},this.dispose=function(){}}function RF(){}var action,bgm=null,se=null,bgs=null,voice=null,bgmFTN=0,bgmFTM=0,bgmYV=0,bgsFTN=0,bgsFTM=0,bgsYV=0,bgmText="",bgsText="";IAudio.cache=[],IAudio.seBuff=null,IAudio.seGainNode=null,IAudio.isAuidoC=!1,window.AudioContext=window.AudioContext||window.webkitAudioContext,IAudio.isAuidoC=window.AudioContext?!0:!1,IAudio.init=function(){bgm=document.getElementById("bgm_audio"),se=IAudio.isAuidoC?new AudioContext:null,bgs=document.getElementById("bgs_audio"),voice=document.getElementById("voice_audio")},IAudio.playSE=function(a,b){var c,d;null!=se&&(IAudio.seGainNode=se[se.createGain?"createGain":"createGainNode"](),IAudio.seGainNode.connect(se.destination),null==b&&(b=80),IAudio.seGainNode.gain.value=b/100,c=IAudio.FindCache(a),null!=c?IAudio.PlayBuff(c.buffer):(d=new XMLHttpRequest,d.abort(),d.open("get",a),d.responseType="arraybuffer",d.onload=function(){IAudio.DecodeAudioData(a,d.response)},d.send()))},IAudio.FindCache=function(a){var b,c;for(b=0;b<IAudio.cache.length;b++)if(IAudio.cache[b].file==a)return c=IAudio.cache[b],IAudio.cache.remove(c),IAudio.cache.unshift(c),c},IAudio.PlayBuff=function(a){IAudio.seBuff=se.createBufferSource(),IAudio.seBuff.buffer=a,IAudio.seBuff.connect(IAudio.seGainNode),IAudio.seBuff[IAudio.seBuff.start?"start":"noteOn"](0)},IAudio.DecodeAudioData=function(a,b){se.decodeAudioData(b,function(b){IAudio.cache.unshift({file:a,buffer:b}),IAudio.cache.length>20&&IAudio.cache.pop(),IAudio.PlayBuff(b)},function(a){log(a)})},IAudio.stopSE=function(){null!=IAudio.seBuff&&IAudio.seBuff[IAudio.seBuff.start?"stop":"noteOff"](0)},IAudio.playVoice=function(a,b){voice.src=IVal.baseMusicPath+a,voice.load(),voice.volume=b/100,voice.play()},IAudio.stopVoice=function(){voice.pause()},IAudio.playBGM=function(a,b){return bgmFTM=0,bgmFTN=0,a==bgmText?(bgm.volume=b/100,void 0):(bgm.src=IVal.baseMusicPath+a,bgmText=a,bgm.load(),bgm.volume=b/100,bgm.loop="loop",bgm.play(),void 0)},IAudio.BGMCallBack=function(){bgm.play()},IAudio.stopBGM=function(){bgm.pause()},IAudio.playBGS=function(a,b){return bgsFTM=0,bgsFTN=0,a==bgsText?(bgs.volume=b/100,void 0):(bgs.src=IVal.baseMusicPath+a,bgsText=a,bgs.load(),bgs.volume=b/100,bgs.loop="loop",bgs.play(),void 0)},IAudio.stopBGS=function(){bgs.pause()},IAudio.BGMFade=function(a){bgmFTN=a*IVal.FPS,bgmFTM=a*IVal.FPS,bgmYV=100*bgm.volume},IAudio.BGSFade=function(a){bgsFTM=a*IVal.FPS,bgsFTN=a*IVal.FPS,bgsYV=100*bgs.volume},IAudio.update=function(){updateBGMFade(),updateBGSFade()},isWeiXin(),IBitmap.ABitmap=function(a){var b=new Image;return b.src="res/"+a,callImage(b)},IBitmap.WBitmap=function(a){var b=new Image;return b.src=a,callImage(b)},IBitmap.CBitmap=function(a,b){return new CBmp(a,b)},IBitmap.toGrayscale=function(a){var b=new Image;return b.src=a.src,b.alt="tg",b},IBitmap.toGrayscaleDo=function(a){var b,c,d,e,f,g,h,i,j;for(tcanvas.width=a.width,tcanvas.height=a.height,tcont.clearRect(0,0,a.width,a.height),tcont.drawImage(a,0,0),b=tcont.getImageData(0,0,tcanvas.width,tcanvas.height),c=0;c<b.width;c++)for(d=0;d<b.height;d++)e=4*(c+d*b.width),f=b.data[e],g=b.data[e+1],h=b.data[e+2],i=.299*f+.587*g+.114*h,b.data[e]=i,b.data[e+1]=i,b.data[e+2]=i,b.data[e+3]=255,(8>c||8>d||c>b.width-8||d>b.height-8)&&(b.data[e]=0,b.data[e+1]=0,b.data[e+2]=0);return tcont.putImageData(b,0,0),j=new Image,j.src=tcanvas.toDataURL("image/png"),j},IColor.Black=function(){return new IColor(0,0,0)},IColor.White=function(){return new IColor(255,255,255)},IColor.Red=function(){return new IColor(255,0,0)},IColor.Blue=function(){return new IColor(0,0,255)},IColor.Green=function(){return new IColor(0,255,0)},IColor.Transparent=function(){return new IColor(0,0,0,0)},IColor.CreatColor=function(a,b,c){return new IColor(a,b,c,255)},IDraw.colorMode={add:"lighter",reduce:"destination-out",none:"source-over"},IFont.getWidth=function(a,b){return tcont.font=b+"px "+IVal.FontName,tcont.measureText(a).width},IFont.getHeight=function(a,b){return tcont.font=b+"px "+IVal.FontName,tcont.measureText("七").width},IInput.down=!1,IInput.Tlong=!1,IInput.move=!1,IInput.up=!1,IInput.tx=0,IInput.dx=0,IInput.x=0,IInput.ty=0,IInput.dy=0,IInput.y=0,IInput.mouseButton=0,IInput.touches=[],IInput.BackButton=!1,IInput.HomeButton=!1,IInput.MenuButton=!1,IInput.keyCodeAry=[],IInput.keyCodeDelAry=[],IInput.keyDown=!1,IInput.keyUp=!1,IInput.isKeyDown=function(a){var b,c;for(b=0;b<IInput.keyCodeAry.length;b++)if(c=IInput.keyCodeAry[b],c==a)return IInput.keyCodeDelAry.indexOf(a)<0&&IInput.keyCodeDelAry.push(a),!0;return!1},IInput.isKeyPress=function(a){var b,c;for(b=0;b<IInput.keyCodeAry.length;b++)if(c=IInput.keyCodeAry[b],c==a)return!0;return!1},IInput.RecoveryKey=function(){var a,b;for(a=0;a<IInput.keyCodeDelAry.length;a++)b=IInput.keyCodeAry.indexOf(IInput.keyCodeDelAry[a]),b>=0&&IInput.keyCodeAry.splice(b,1);IInput.keyCodeDelAry=[]},action={fade:1,move:2,rotate:3,wait:4,zoom:5},IRWFile.SaveKV=function(a,b){var c=JSON.stringify(b);localStorage.setItem(a,c)},IRWFile.LoadKV=function(a){return JSON.parse(localStorage.getItem(a))},IScrollbar.Dir={Left:0,Right:1,Down:2,Up:3},ISprite.toRegular=function(a){var c,d,b=a;for(c in IVal.regularList)d=IVal.regularList[c],b=b.replaceAll(c,d);return b},IVal.FPS=60,IVal.GWidth=0,IVal.GHeight=0,IVal.startScene=null,IVal.scene=null,IVal.FontColor=IColor.White(),IVal.FontSize=18,IVal.DEBUG=!1,IVal.FontName="微软雅黑",IVal.dSound=null,IVal.regularList={},IVal.baseMusicPath="",IVal.baseBPath="",IVal.updateNumSp=0,IVal.Platform="PC",IVal.SceneRect=new IRect(0,0,1,1),IViewport.Dir={All:0,Horizontal:1,None:2,Vertical:3},IViewport.Type={Rectangle:0,Round:1},IWeb.getUrl=function(a,b){var c=b||!1,d=$.ajax({url:a,async:c});return d.responseText},IWeb.getBitmapFromURL=function(a){var b=new Image;return b.src=a,b},IWeb.getJsonpObj=function(a,b){$.ajax({type:"get",async:!0,url:a,dataType:"jsonp",success:function(a){b(a)},error:function(){console.log(a+"  抓取失败")}})},IWeb.getJsonObj=function(a,b){$.ajax({type:"get",async:!0,url:a,dataType:"json",success:function(a){b(a)},error:function(){console.log(a+"  抓取失败")}})},RF.RandomChoose=function(a){return a[Math.floor(Math.random()*a.length)]},RF.ProbabilityHit=function(a){var b=Math.random();return a>b};